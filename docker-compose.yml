services:
  ros2-vnc-ws1:
    image: ghcr.io/wing-kit/neo_humble:latest
    platform: linux/amd64
    ports:
      - "0.0.0.0:36081:80"
      - "0.0.0.0:32221:22"
      - "0.0.0.0:33081:8080"
      - "0.0.0.0:33390:3389"
    cap_add:
      - NET_ADMIN
      - SYS_ADMIN
    shm_size: '16g'
    security_opt:
      - seccomp:unconfined
    container_name: ros2-humble
    volumes:
      - ~/projects/aic_swarm/ros2_workspaces/ws1:/home/ubuntu/ros2_ws
      - ~/projects/aic_swarm/ros2_workspaces/shared:/home/ubuntu/shared
      - ~/projects/aic_swarm/ros2_workspaces/shared/nginx-conf/doc.conf:/etc/nginx/conf.d/doc.conf
      - ~/projects/aic_swarm/xsession:/home/ubuntu/.xsession
      - ~/projects/aic_swarm/xrdp.ini:/home/ubuntu/xrdp.ini
    environment:
      - USER=ubuntu
      - PASSWORD=123456   # ‚Üê CHANGE TO YOUR STRONG PASSWORD
      - DEBIAN_FRONTEND=noninteractive
    entrypoint: ["/bin/bash", "-c"]
    command: |
      "mkdir -p /var/run/sshd && rm -rf /home/ubuntu/ws_* &&
       sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/' /etc/ssh/sshd_config &&
       sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin no/' /etc/ssh/sshd_config &&
       /usr/sbin/sshd -D &
       chmod +x /home/ubuntu/shared/tools/easytier-linux-x86_64/easytier-core &&
       chmod +x /home/ubuntu/ros2_ws/easytier/start.sh &&
       /home/ubuntu/ros2_ws/easytier/start.sh &
       /usr/bin/redis-server &
       apt update && apt install xrdp xorgxrdp dbus-x11 -y --no-install-recommends && ufw disable && chmod +x /home/ubuntu/.xsession && cp -rf /home/ubuntu/xrdp.ini /etc/xrdp/xrdp.ini && service xrdp start && exec /entrypoint.sh"
